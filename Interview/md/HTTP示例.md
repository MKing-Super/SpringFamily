# HTTP示例

## 一、概述

### 1 简介

**HTTP**的全称是 **超文本传输协议**。

- **协议**：一套通信双方必须共同遵守的规则。就像两个人打电话，必须使用同一种语言和语法才能交流。
- **传输**：HTTP 协议的作用是在两点之间传输数据。在 Web 环境中，通常是在**客户端**和**服务器**之间。

- **超文本**：最初指包含**超链接**的文本（如 HTML），现在可以传输图片、视频、音频等任何类型的数据。

**简单来说，HTTP 就是一套规定了浏览器如何从服务器获取网页、图片等资源的规则。**



### 2 核心特点

**1、无连接（早期）** 

​		在 HTTP/1.0 及之前，每次请求/响应完成后就会断开 TCP 连接。

**缺点**：建立和断开连接开销很大。现代 HTTP/1.1 默认使用**持久连接**，一个连接可以用于多次请求/响应。

**2、无状态** 

​		这是 HTTP 一个非常重要的特性。协议本身**不记录**之前的请求或响应的任何信息。每个请求都是独立的，服务器不会记住你上一次做了什么。

**问题**：如何实现登录、购物车等功能？这就需要用到 **Cookie**和 **Session**等技术来“管理状态”。

**3、基于请求-响应模型** 

​		通信总是由**客户端**发起请求，**服务器**返回响应。服务器不能主动向客户端推送消息。

**解决方案**：为了实现实时通信，后来出现了 WebSocket 等技术。

**4、简单、灵活、可扩展** 

- HTTP 的报文是纯文本格式（HTTP/2 之前），易于阅读和调试。 
- 可以通过请求头/响应头轻松添加新功能，具有很好的扩展性。



### 3 工作流程

一次完整的 HTTP 通信过程可以概括为以下几步：

1. **建立 TCP 连接**：客户端（通常是浏览器）首先与服务器的 80 端口（HTTP）或 443 端口（HTTPS）建立一个 TCP 连接。
2. **发送 HTTP 请求**：客户端向服务器发送一个请求报文。
3. **服务器处理请求**：服务器收到请求后，进行处理（如查找资源、运行程序）。
4. **返回 HTTP 响应**：服务器将处理结果封装成一个响应报文，发回给客户端。
5. **关闭 TCP 连接**：对于早期 HTTP/1.0，连接会关闭。对于 HTTP/1.1 的持久连接，连接会保持一段时间，以供后续请求使用。
6. **客户端解析渲染**：客户端（浏览器）解析响应内容，并将网页渲染展示给用户。



### 4 报文结构

​		HTTP 报文分为两种：**请求报文**和 **响应报文**。

#### 1 HTTP 请求报文

​		一个请求报文由以下四部分组成：

```
请求行
请求头
空行
请求体
```

**请求行**：包含请求方法、请求的 URL 和 HTTP 版本。

例如：`GET /index.html HTTP/1.1`



**请求头**：包含关于请求的附加信息，以键值对的形式存在。 

常见头信息： 

`Host: www.example.com`（目标主机，必填） 

`User-Agent: Mozilla/5.0...`（客户端信息） 

`Accept: text/html`（客户端能接受的数据类型）

`Cookie: name=value`（客户端的 Cookie）



**空行**：用于分隔头部和主体，必不可少。



**请求体**：可选部分。通常在 POST、PUT 等方法中，用于携带要发送给服务器的数据（如表单数据、JSON 等）。

```http
POST /login HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
Content-Type: application/x-www-form-urlencoded
Content-Length: 28

username=john&password=123456
```



#### 2 HTTP 响应报文

​		一个响应报文由以下四部分组成：

```
状态行
响应头
空行
响应体
```

**状态行**：包含 HTTP 版本、状态码和状态描述。

例如：`HTTP/1.1 200 OK`



**响应头**：包含关于响应的附加信息。 

常见头信息：

 `Content-Type: text/html; charset=utf-8`（响应体的数据类型）

 `Content-Length: 1024`（响应体的长度）

`Set-Cookie: sessionId=abc123`（服务器设置 Cookie）



**空行**：用于分隔头部和主体。



**响应体**：服务器返回的实际数据，如 HTML 内容、图片数据等。

```http
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 1354
Set-Cookie: user=JohnDoe

<html>
  <head><title>Home Page</title></head>
  <body>...</body>
</html>
```



### 5 请求方法

| 方法     | 描述                                           | 幂等性 | 安全性 |
| -------- | ---------------------------------------------- | ------ | ------ |
| **GET**  | **获取**资源。只用于请求数据，不应产生副作用。 | 是     | 是     |
| **POST** | **创建**新资源或提交数据（如提交表单）。       | 否     | 否     |



### 6 HTTP 状态码

状态码用于表示请求的处理结果，分为五类：

| 范围 | 类别           | 含义                                     | 常见例子                                                     |
| ---- | -------------- | ---------------------------------------- | ------------------------------------------------------------ |
| 1xx  | **信息性**     | 请求已被接收，继续处理。                 | 100 Continue                                                 |
| 2xx  | **成功**       | 请求已成功被服务器接收、理解、并接受。   | **200 OK**（成功），201 Created（已创建），204 No Content（无内容） |
| 3xx  | **重定向**     | 需要客户端采取进一步的操作才能完成请求。 | **301 Moved Permanently**（永久重定向），**302 Found**（临时重定向），304 Not Modified（使用缓存） |
| 4xx  | **客户端错误** | 请求包含语法错误或无法完成请求。         | **400 Bad Request**（错误请求），**401 Unauthorized**（未授权），**403 Forbidden**（禁止访问），**404 Not Found**（资源未找到） |
| 5xx  | **服务器错误** | 服务器在处理请求的过程中发生了错误。     | **500 Internal Server Error**（服务器内部错误），502 Bad Gateway（网关错误），503 Service Unavailable（服务不可用） |



### 7 HTTP 版本演进

- **HTTP/0.9**： 极其简单，只有 GET 方法。
- **HTTP/1.0**： 增加了请求头、状态码、多种请求方法，但每个连接只处理一个请求，性能差。
- **HTTP/1.1（当前主流）**： 引入了**持久连接**、管道化、更多的缓存控制策略，是目前使用最广泛的版本。
- **HTTP/2**： 重大更新，采用二进制格式、多路复用、头部压缩、服务器推送，大幅提升性能。

- **HTTP/3**： 基于 QUIC 协议，旨在进一步减少延迟，解决 TCP 的队头阻塞问题。

### 总结

​		HTTP 是一个简单而强大的应用层协议，它通过**请求-响应**模型奠定了 Web 通信的基础。













