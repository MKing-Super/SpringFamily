<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<!--<script type="text/javascript" src="jquery.js"></script>-->
<script type="text/javascript" th:src="@{/js/jquery-1.8.3.js}"></script>
<script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>

<body>
<div id="main" style="width: 100%;height:800px;"></div>
<input type="button" id="stop" value="开始" onclick="chartStop()">
</body>

</html>
<script type="text/javascript">
    $(function (){

    });


    var stop = 2;

    function chartStop() {
        if (stop === 0){
            stop = 2
            $("#stop").val('暂停')
        }else {
            stop = 0
            $("#stop").val('开始')
        }
    }

    function getData() {
        var result = null;
        $.ajax({
            url:"/chart/getData",
            async: false,
            success:function(data){
                result = data;
            }
        });
        while (true){
            if (result !== null){
                return result
            }
        }
    }


    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));

    function randomData() {
        now = new Date(+now + oneDay);
        // value = getData();
        value = value + Math.random() * 21 - 10;
        return {
            name: now.toString(),
            value: [
                [now.getFullYear(), now.getMonth() + 1, now.getDate()].join('/'),
                Math.round(value)
            ]
        }
    }
    var data = [];
    var now = +new Date(1997, 9, 3);
    var oneDay = 24 * 3600 * 1000;
    var value = Math.random() * 1000;
    for(var i = 0; i < 100; i++) {
        data.push(randomData());
    }
    option = {
        title: {
            text: '动态数据 + 时间坐标轴'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function(params) {
                params = params[0];
                var date = new Date(params.name);
                return date.getFullYear() + '/' + (date.getMonth() + 1) + '/' + date.getDate() + '/'  + ' : ' + params.value[1];
            },
            axisPointer: {
                animation: false
            }
        },
        xAxis: {
            type: 'time',
            splitLine: {
                show: false
            }
        },
        yAxis: {
            type: 'value',
            boundaryGap: [0, '100%'],
            splitLine: {
                show: false
            }
        },
        series: [{
            name: '模拟数据',
            type: 'line',
            showSymbol: false,
            hoverAnimation: false,
            data: data,
            markLine: {
                itemStyle: {
                    normal: {
                        borderWidth: 1,
                        lineStyle: {
                            type: "dash",
                            color: 'red',
                            width: 2
                        },
                        label: {
                            formatter: 'COD',
                            textStyle: {
                                fontSize: 16,
                                fontWeight: "bolder"
                            }
                        },
                        show: true,
                        color: '#4c5336'
                    }
                },
                data: [{
                    yAxis: 5000
                }]
            },
        }],
    };
    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
    setInterval(function() {
        for(var i = 0; i < stop; i++) {
            debugger
            data.shift();
            data.push(randomData());
        }
        myChart.setOption({
            series: [{
                data: data
            }]
        });
    }, 1000);
</script>